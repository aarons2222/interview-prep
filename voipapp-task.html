<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoIPApp Interview Task - On Hold Notification</title>
    <style>
        :root {
            --bg: #0d1117;
            --card: #161b22;
            --border: #30363d;
            --text: #c9d1d9;
            --text-muted: #8b949e;
            --accent: #58a6ff;
            --green: #3fb950;
            --yellow: #d29922;
            --red: #f85149;
            --purple: #a371f7;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }
        
        .subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        h2 {
            color: var(--green);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        h3 {
            color: var(--purple);
            margin: 1.5rem 0 0.75rem;
        }
        
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .finding {
            border-left: 4px solid var(--accent);
        }
        
        .solution {
            border-left: 4px solid var(--green);
        }
        
        .question {
            border-left: 4px solid var(--yellow);
        }
        
        .warning {
            border-left: 4px solid var(--red);
            background: rgba(248, 81, 73, 0.1);
        }
        
        code {
            background: #1f2428;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 0.9em;
            color: #ff7b72;
        }
        
        pre {
            background: #1f2428;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }
        
        pre code {
            background: none;
            padding: 0;
            color: var(--text);
        }
        
        .comment { color: #8b949e; }
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .method { color: #d2a8ff; }
        .class { color: #7ee787; }
        .number { color: #79c0ff; }
        
        ul, ol {
            margin: 0.5rem 0 0.5rem 1.5rem;
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        .file-path {
            color: var(--accent);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.85em;
        }
        
        .tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        
        .tag-file { background: rgba(88, 166, 255, 0.2); color: var(--accent); }
        .tag-line { background: rgba(63, 185, 80, 0.2); color: var(--green); }
        .tag-unused { background: rgba(248, 81, 73, 0.2); color: var(--red); }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }
        
        th {
            background: var(--card);
            color: var(--accent);
        }
        
        .toc {
            background: var(--card);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .toc a {
            color: var(--accent);
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--accent);
            color: var(--bg);
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        @media (max-width: 600px) {
            body { padding: 1rem; }
            pre { font-size: 0.85em; }
        }
    </style>
</head>
<body>
    <h1>üì± VoIPApp Interview Task</h1>
    <p class="subtitle">Update Active Call notification to show "On Hold" status</p>
    
    <div class="toc">
        <strong>Contents:</strong>
        <ol>
            <li><a href="#task">Task Overview</a></li>
            <li><a href="#findings">Code Analysis & Findings</a></li>
            <li><a href="#solution">Implementation Solution</a></li>
            <li><a href="#questions">Questions to Ask</a></li>
            <li><a href="#gradle">Android Studio Setup</a></li>
        </ol>
    </div>

    <!-- TASK OVERVIEW -->
    <h2 id="task">üìã Task Overview</h2>
    <div class="card finding">
        <p><strong>Objective:</strong> Update the Active Call notification to display "On Hold" when a call is placed on hold.</p>
        <p style="margin-top: 1rem;"><strong>Key Insight:</strong> The interviewer expects you to ask sensible questions about the code to avoid delays. Don't dive in blind!</p>
    </div>

    <!-- FINDINGS -->
    <h2 id="findings">üîç Code Analysis & Findings</h2>
    
    <h3>1. Notification Channels</h3>
    <div class="card finding">
        <p class="file-path">üìÅ App.java (lines 36-40)</p>
        <pre><code><span class="keyword">public static final</span> <span class="class">String</span> SERVICE_CHANNEL_ID = <span class="string">"serviceChannelId"</span>;      <span class="comment">// ‚Üê Currently used</span>
<span class="keyword">public static final</span> <span class="class">String</span> MISSCALL_CHANNEL_ID = <span class="string">"missCallChannelId"</span>;
<span class="keyword">public static final</span> <span class="class">String</span> INCOMING_CALLS_CHANNEL_ID = <span class="string">"incomingCallsChannelId"</span>;
<span class="keyword">public static final</span> <span class="class">String</span> ACTIVE_CALLS_CHANNEL_ID = <span class="string">"activeCalls"</span>;      <span class="comment">// ‚Üê DEFINED but NEVER USED!</span>
<span class="keyword">public static final</span> <span class="class">String</span> MFA_CHANNEL_ID = <span class="string">"mfaChannelId"</span>;</code></pre>
        <p style="margin-top: 1rem;">
            <span class="tag tag-unused">‚ö†Ô∏è UNUSED</span>
            <code>ACTIVE_CALLS_CHANNEL_ID</code> exists but is never referenced anywhere in the codebase!
        </p>
    </div>

    <h3>2. Current Active Call Notification</h3>
    <div class="card finding">
        <p class="file-path">üìÅ VoIPService.java (lines 104-106)</p>
        <pre><code><span class="class">Notification</span> notification = <span class="keyword">new</span> <span class="class">NotificationCompat.Builder</span>(<span class="keyword">this</span>, App.SERVICE_CHANNEL_ID)
    .<span class="method">setContentTitle</span>(<span class="string">"VoIP Service"</span>)
    .<span class="method">setContentText</span>(<span class="string">"VoIP service is active."</span>)  <span class="comment">// ‚Üê Static, never changes!</span>
    .<span class="method">setSmallIcon</span>(R.drawable.ic_stat_logo_white)
    .<span class="method">setContentIntent</span>(pendingIntent)
    .<span class="method">build</span>();</code></pre>
        <p style="margin-top: 1rem;"><strong>Problem:</strong> This notification is created <em>once</em> when the service starts and is <strong>never updated</strong>.</p>
    </div>

    <h3>3. Hold State Management</h3>
    <div class="card finding">
        <p class="file-path">üìÅ VoIPManagerPJAPI.java</p>
        <table>
            <tr>
                <th>Method</th>
                <th>Line</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><code>toggleHold()</code></td>
                <td>384</td>
                <td>Toggles hold state, returns <code>true</code> if now on hold</td>
            </tr>
            <tr>
                <td><code>getIsOnHold()</code></td>
                <td>481</td>
                <td>Returns current hold state from PJSIP manager</td>
            </tr>
            <tr>
                <td><code>holdCall()</code></td>
                <td>398</td>
                <td>Explicitly puts call on hold</td>
            </tr>
            <tr>
                <td><code>continueCall()</code></td>
                <td>405</td>
                <td>Resumes call from hold</td>
            </tr>
        </table>
    </div>

    <h3>4. UI Hold Button Update</h3>
    <div class="card finding">
        <p class="file-path">üìÅ CallActivity.java (lines 361-376)</p>
        <pre><code><span class="keyword">protected void</span> <span class="method">onHoldPressed</span>(<span class="class">View</span> view) {
    VoIPLogger.<span class="method">debug</span>(<span class="string">"Hold pressed."</span>);
    <span class="class">IVoIPManager</span> manager = VoIPManager.<span class="method">getInstance</span>();
    <span class="keyword">if</span> (manager != <span class="keyword">null</span>) {
        <span class="keyword">boolean</span> onHold = manager.<span class="method">toggleHold</span>();  <span class="comment">// ‚Üê Hold changes here</span>
        <span class="keyword">this</span>.<span class="method">setHoldButton</span>(onHold);              <span class="comment">// ‚Üê Only updates UI button!</span>
    }
}

<span class="keyword">private void</span> <span class="method">setHoldButton</span>(<span class="keyword">boolean</span> onHold) {
    <span class="class">ImageButton</span> holdButton = <span class="keyword">this</span>.<span class="method">findViewById</span>(R.id.callHoldButton);
    <span class="keyword">if</span> (onHold) {
        <span class="method">setImageBackground</span>(holdButton, R.drawable.call_view_item_off_button);
    } <span class="keyword">else</span> {
        <span class="method">setImageBackground</span>(holdButton, R.drawable.call_view_item_button);
    }
}</code></pre>
        <p style="margin-top: 1rem;"><strong>Gap:</strong> When hold is toggled, the UI button updates but the <strong>notification is never touched</strong>.</p>
    </div>

    <h3>5. The Missing Link</h3>
    <div class="card warning">
        <h4>üéØ Root Cause</h4>
        <p>There is <strong>no code</strong> that connects the hold state change to a notification update.</p>
        <ul>
            <li><code>VoIPService</code> creates a static notification at startup</li>
            <li><code>toggleHold()</code> changes the PJSIP call state</li>
            <li><code>CallActivity</code> updates the UI button</li>
            <li><strong>Nothing updates the notification!</strong></li>
        </ul>
    </div>

    <!-- SOLUTION -->
    <h2 id="solution">‚úÖ Implementation Solution</h2>
    
    <h3>Step 1: Add Notification Update Method to VoIPService</h3>
    <div class="card solution">
        <p class="file-path">üìÅ VoIPService.java</p>
        <pre><code><span class="comment">// Add these imports at the top</span>
<span class="keyword">import</span> android.app.NotificationManager;

<span class="comment">// Add this method to VoIPService class</span>
<span class="keyword">public static void</span> <span class="method">updateNotification</span>(<span class="class">Context</span> context, <span class="keyword">boolean</span> isOnHold) {
    <span class="keyword">if</span> (instance == <span class="keyword">null</span> || Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {
        <span class="keyword">return</span>;
    }
    
    <span class="class">Intent</span> notificationIntent = <span class="keyword">new</span> <span class="class">Intent</span>(context, MainActivity.<span class="keyword">class</span>);
    <span class="class">PendingIntent</span> pendingIntent = <span class="class">PendingIntent</span>.<span class="method">getActivity</span>(context,
            <span class="number">0</span>, notificationIntent, PendingIntent.FLAG_IMMUTABLE);
    
    <span class="class">String</span> title = isOnHold ? <span class="string">"Call On Hold"</span> : <span class="string">"VoIP Service"</span>;
    <span class="class">String</span> text = isOnHold ? <span class="string">"Tap to resume call"</span> : <span class="string">"VoIP service is active."</span>;
    
    <span class="class">Notification</span> notification = <span class="keyword">new</span> <span class="class">NotificationCompat.Builder</span>(context, App.SERVICE_CHANNEL_ID)
            .<span class="method">setContentTitle</span>(title)
            .<span class="method">setContentText</span>(text)
            .<span class="method">setSmallIcon</span>(R.drawable.ic_stat_logo_white)
            .<span class="method">setContentIntent</span>(pendingIntent)
            .<span class="method">setOngoing</span>(<span class="keyword">true</span>)
            .<span class="method">build</span>();
    
    <span class="class">NotificationManager</span> notificationManager = 
        (<span class="class">NotificationManager</span>) context.<span class="method">getSystemService</span>(Context.NOTIFICATION_SERVICE);
    notificationManager.<span class="method">notify</span>(SERVICE_NOTIFICATION_ID, notification);
}</code></pre>
    </div>

    <h3>Step 2: Call Update from VoIPManagerPJAPI</h3>
    <div class="card solution">
        <p class="file-path">üìÅ VoIPManagerPJAPI.java ‚Äî Update toggleHold() method</p>
        <pre><code><span class="keyword">@Override</span>
<span class="keyword">public boolean</span> <span class="method">toggleHold</span>() {
    <span class="keyword">boolean</span> isOnHold = <span class="keyword">false</span>;
    <span class="keyword">try</span> {
        <span class="keyword">if</span> (manager.<span class="method">isOnHold</span>()) {
            manager.<span class="method">continueCall</span>();
        } <span class="keyword">else</span> {
            manager.<span class="method">holdCall</span>();
            isOnHold = <span class="keyword">true</span>;
        }
        <span class="comment">// ‚úÖ ADD THIS LINE - Update notification</span>
        VoIPService.<span class="method">updateNotification</span>(context, isOnHold);
    } <span class="keyword">catch</span> (<span class="class">Exception</span> e) {
        VoIPLogger.<span class="method">error</span>(<span class="string">"Failed to toggle hold "</span> + e.<span class="method">getMessage</span>());
    }
    <span class="keyword">return</span> isOnHold;
}</code></pre>
        <p style="margin-top: 1rem;"><strong>Note:</strong> You'll need access to a <code>Context</code> in VoIPManagerPJAPI. Check if it already has one, or pass it through.</p>
    </div>

    <h3>Alternative: Update from CallActivity</h3>
    <div class="card solution">
        <p class="file-path">üìÅ CallActivity.java ‚Äî Simpler option if Context is tricky</p>
        <pre><code><span class="keyword">protected void</span> <span class="method">onHoldPressed</span>(<span class="class">View</span> view) {
    VoIPLogger.<span class="method">debug</span>(<span class="string">"Hold pressed."</span>);
    <span class="class">IVoIPManager</span> manager = VoIPManager.<span class="method">getInstance</span>();
    <span class="keyword">if</span> (manager != <span class="keyword">null</span>) {
        <span class="keyword">boolean</span> onHold = manager.<span class="method">toggleHold</span>();
        <span class="keyword">this</span>.<span class="method">setHoldButton</span>(onHold);
        <span class="comment">// ‚úÖ ADD THIS LINE - Update notification</span>
        VoIPService.<span class="method">updateNotification</span>(<span class="keyword">this</span>, onHold);
    }
}</code></pre>
    </div>

    <!-- QUESTIONS TO ASK -->
    <h2 id="questions">‚ùì Questions to Ask the Interviewer</h2>
    
    <p style="margin-bottom: 1rem; color: var(--text-muted);">The task mentions asking sensible questions to avoid delays. Here are good ones:</p>

    <div class="card question">
        <h4>1. Notification Channel Clarification</h4>
        <p><em>"I noticed there's an <code>ACTIVE_CALLS_CHANNEL_ID</code> defined in App.java but it doesn't appear to be used anywhere. Should I use this channel for the active call notification, or continue using <code>SERVICE_CHANNEL_ID</code>?"</em></p>
        <p style="margin-top: 0.5rem; color: var(--text-muted);">Shows you've explored the codebase and noticed the unused constant.</p>
    </div>

    <div class="card question">
        <h4>2. Notification Content</h4>
        <p><em>"For the 'On Hold' notification, what text would you prefer? Something like 'Call On Hold' for the title and 'Tap to resume' for the description? Or should it match an existing style?"</em></p>
        <p style="margin-top: 0.5rem; color: var(--text-muted);">Shows attention to UX and consistency.</p>
    </div>

    <div class="card question">
        <h4>3. Edge Cases</h4>
        <p><em>"Should the notification also update if the remote party places us on hold? I see the hold state is tracked via PJSIP callbacks."</em></p>
        <p style="margin-top: 0.5rem; color: var(--text-muted);">Shows you're thinking about the full user experience.</p>
    </div>

    <div class="card question">
        <h4>4. Architecture Preference</h4>
        <p><em>"I could update the notification from <code>VoIPManagerPJAPI.toggleHold()</code> or from <code>CallActivity.onHoldPressed()</code>. Do you have a preference for where this logic should live?"</em></p>
        <p style="margin-top: 0.5rem; color: var(--text-muted);">Shows you understand there are multiple valid approaches.</p>
    </div>

    <div class="card question">
        <h4>5. Testing</h4>
        <p><em>"Is there a test SIP account or server I can use to verify the hold functionality works correctly?"</em></p>
        <p style="margin-top: 0.5rem; color: var(--text-muted);">Practical question showing you want to test your work.</p>
    </div>

    <!-- ANDROID STUDIO SETUP -->
    <h2 id="gradle">üõ†Ô∏è Android Studio Setup</h2>
    
    <div class="card warning">
        <h4>‚ö†Ô∏è Open the Correct Folder!</h4>
        <p>The project structure is:</p>
        <pre><code>~/Desktop/vipVoipAndroidAppInterview1/
‚îú‚îÄ‚îÄ interview.txt
‚îî‚îÄ‚îÄ androidapp/
    ‚îî‚îÄ‚îÄ VoIPApp/          ‚Üê Open THIS folder in Android Studio
        ‚îú‚îÄ‚îÄ build.gradle
        ‚îú‚îÄ‚îÄ settings.gradle
        ‚îî‚îÄ‚îÄ app/</code></pre>
    </div>

    <div class="card solution">
        <h4>Steps to Fix</h4>
        <ol>
            <li><span class="step-number">1</span> <strong>File ‚Üí Close Project</strong></li>
            <li><span class="step-number">2</span> <strong>File ‚Üí Open</strong></li>
            <li><span class="step-number">3</span> Navigate to: <code>~/Desktop/vipVoipAndroidAppInterview1/androidapp/VoIPApp</code></li>
            <li><span class="step-number">4</span> Select the <strong>VoIPApp</strong> folder (should show Android icon)</li>
            <li><span class="step-number">5</span> Click <strong>Open</strong></li>
            <li><span class="step-number">6</span> If prompted "Trust this project?" ‚Üí <strong>Trust</strong></li>
            <li><span class="step-number">7</span> Wait for Gradle sync (bottom right progress bar)</li>
        </ol>
        <p style="margin-top: 1rem;">If Gradle still doesn't sync: <strong>File ‚Üí Sync Project with Gradle Files</strong> (üêò icon)</p>
    </div>

    <hr style="margin: 3rem 0; border: none; border-top: 1px solid var(--border);">
    
    <p style="text-align: center; color: var(--text-muted);">
        Good luck with the interview! üçÄ<br>
        <small>Created for Aaron Strickland ‚Äî Feb 5, 2026</small>
    </p>
</body>
</html>
